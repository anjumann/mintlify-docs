---
title: 'Deployment Guide'
description: 'Instructions for deploying the HeyHomie Next.js application to different environments'
---

# Deployment Guide

This document provides instructions for deploying the HeyHomie Next.js application to different environments.

## Prerequisites

### Setting Up Google Cloud CLI

<Steps>
  <Step title="Install Google Cloud CLI">
    <Tabs>
      <Tab title="Debian/Ubuntu">
        ```bash
        echo "deb [signed-by=/usr/share/keyrings/cloud.google.gpg] https://packages.cloud.google.com/apt cloud-sdk main" | sudo tee -a /etc/apt/sources.list.d/google-cloud-sdk.list
        curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key --keyring /usr/share/keyrings/cloud.google.gpg add -
        sudo apt-get update && sudo apt-get install google-cloud-sdk
        ```
      </Tab>
      <Tab title="macOS">
        ```bash
        brew install --cask google-cloud-sdk
        ```
      </Tab>
      <Tab title="Windows">
        Download the installer from <https://cloud.google.com/sdk/docs/install#windows>
      </Tab>
    </Tabs>
  </Step>

  <Step title="Initialize and Log In">
    ```bash
    gcloud init
    gcloud auth login
    ```
  </Step>

  <Step title="Set Project">
    ```bash
    gcloud config set project heyhomie-project
    ```
  </Step>
</Steps>

## Deployment Environments

### Development Environment

The development environment is used for testing new features before they are promoted to production. All team members can deploy to this environment.

<Steps>
  <Step title="Deploy to Development">
    ```bash
    ./scripts/deploy.sh
    ```

    This script will:
    1. Build the application
    2. Run unit tests
    3. Package the application
    4. Deploy to Google Cloud Run
  </Step>

  <Step title="Monitor Deployment">
    You can monitor the deployment in the Google Cloud Console or using:

    ```bash
    gcloud run services list
    ```
  </Step>

  <Step title="Access the Application">
    After deployment, the application will be available at: <https://dev.heyhomie.app>
  </Step>
</Steps>

### Production Environment

<Warning>
  ⚠️ **IMPORTANT**: Only senior team members should deploy to the production environment.
</Warning>

<Steps>
  <Step title="Deploy to Production">
    ```bash
    ./scripts/deploy-prod.sh
    ```
  </Step>

  <Step title="Verify Deployment">
    After deployment, the application will be available at: <https://app.heyhomie.com>
  </Step>
</Steps>

## Deployment Scripts

### deploy.sh

The `deploy.sh` script handles deployment to the development environment:

```bash
#!/bin/bash
set -e

echo "Building application..."
yarn build

echo "Running tests..."
yarn test

echo "Packaging application..."
docker build -t gcr.io/heyhomie-project/heyhomie-app:dev .

echo "Pushing Docker image..."
docker push gcr.io/heyhomie-project/heyhomie-app:dev

echo "Deploying to development environment..."
gcloud run deploy heyhomie-app-dev \
  --image gcr.io/heyhomie-project/heyhomie-app:dev \
  --platform managed \
  --region us-central1 \
  --allow-unauthenticated

echo "Deployment complete! Application is available at:"
gcloud run services describe heyhomie-app-dev --platform managed --region us-central1 --format='value(status.url)'
```

### deploy-prod.sh

The `deploy-prod.sh` script handles deployment to the production environment:

```bash
#!/bin/bash
set -e

# This script is restricted to senior team members

echo "Building application for production..."
yarn build

echo "Running tests..."
yarn test

echo "Packaging application..."
docker build -f Dockerfile.prod -t gcr.io/heyhomie-project/heyhomie-app:prod .

echo "Pushing Docker image..."
docker push gcr.io/heyhomie-project/heyhomie-app:prod

echo "Deploying to production environment..."
gcloud run deploy heyhomie-app-prod \
  --image gcr.io/heyhomie-project/heyhomie-app:prod \
  --platform managed \
  --region us-central1 \
  --allow-unauthenticated

echo "Deployment complete! Application is available at:"
gcloud run services describe heyhomie-app-prod --platform managed --region us-central1 --format='value(status.url)'
```

## Monitoring Deployments

### Viewing Deployment History

To view deployment history:

```bash
gcloud run revisions list --service heyhomie-app-dev --platform managed --region us-central1
```

### Rollback to Previous Version

<Steps>
  <Step title="Identify the Revision to Roll Back To">
    ```bash
    gcloud run revisions list --service heyhomie-app-dev --platform managed --region us-central1
    ```
  </Step>

  <Step title="Perform the Rollback">
    ```bash
    gcloud run services update-traffic heyhomie-app-dev --to-revisions=REVISION_ID=100 --platform managed --region us-central1
    ```

    Replace `REVISION_ID` with the ID of the revision you want to roll back to.
  </Step>
</Steps>

## Environment Variables

The deployment scripts use environment variables defined in Google Cloud Run. These are sourced from the `.env.development` and `.env.production` files for the respective environments.

To add or update environment variables:

```bash
gcloud run services update heyhomie-app-dev --set-env-vars KEY=VALUE --platform managed --region us-central1
```

## Deployment Best Practices

<Checklist>
  - Always Test Locally First: Ensure your changes work locally before deploying
  - Deploy to Development First: Always test in the development environment before production
  - Check Logs After Deployment: Verify logs for any errors after deployment
  - Perform Smoke Tests: Validate critical functionality after deployment
  - Be Ready to Rollback: Know how to quickly rollback if issues are detected
  - Deploy During Low-Traffic Periods: Schedule production deployments during low-traffic periods
  - Communicate Deployments: Inform the team before and after deployments
  - Monitor Performance: Watch for performance degradation after deployment
</Checklist>

## Troubleshooting

### Common Deployment Issues

<AccordionGroup>
  <Accordion icon="code" title="Build Failures">
    - Check for TypeScript errors
    - Verify all dependencies are correctly installed
  </Accordion>

  <Accordion icon="docker" title="Docker Build Issues">
    - Ensure Docker is running
    - Verify Dockerfile syntax
  </Accordion>

  <Accordion icon="server" title="Deployment Failures">
    - Check Google Cloud permissions
    - Verify Google Cloud service account configuration
  </Accordion>

  <Accordion icon="bug" title="Post-Deployment Issues">
    Check application logs:

    ```bash
    gcloud logging read "resource.type=cloud_run_revision AND resource.labels.service_name=heyhomie-app-dev" --limit=10
    ```
  </Accordion>
</AccordionGroup>

## Continuous Integration/Continuous Deployment (CI/CD)

For automated deployments, we use GitHub Actions. The workflow files are located in `.github/workflows/`:

- `dev-deploy.yml`: Triggers deployment to the development environment on pushes to the `develop` branch
- `prod-deploy.yml`: Triggers deployment to the production environment on pushes to the `main` branch (requires approval) 